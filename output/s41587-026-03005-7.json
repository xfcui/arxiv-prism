{
  "title": "Accurate plasmid reconstruction from metagenomics data using assembly–alignment graphs and contrastive learning",
  "doi": "10.1038/s41587-026-03005-7",
  "abstract": "Plasmids are extrachromosomal DNA molecules that enable horizontal gene transfer in bacteria, often conferring advantages such as antibiotic resistance. Despite their importance, plasmids are underrepresented in genomic databases because of challenges in assembling them, caused by mosaicism and microdiversity. Current plasmid assemblers rely on detecting circular paths in single-sample assembly graphs but face limitations because of graph fragmentation, entanglement and low coverage. We introduce PlasMAAG (plasmid and organism metagenomic binning using assembly–alignment graphs), a method to recover plasmids and cellular genomes from metagenomic samples. PlasMAAG complements assembly graph signals across samples by generating an ‘assembly–alignment graph’, which is used alongside common binning features for improved plasmid reconstruction. On synthetic benchmark datasets, PlasMAAG reconstructed 50–121% more near-complete plasmids than competing methods and improved the Matthews correlation coefficient of geNomad contig classification by 28–106%. On hospital sewage samples, PlasMAAG outperformed competing methods, reconstructing 33% more plasmid sequences. PlasMAAG enables the study of organism–plasmid associations and intraplasmid diversity across samples.",
  "sections": [
    {
      "title": "Abstract",
      "level": 1,
      "content": "Plasmids are extrachromosomal DNA molecules that enable horizontal gene transfer in bacteria, often conferring advantages such as antibiotic resistance. Despite their importance, plasmids are underrepresented in genomic databases because of challenges in assembling them, caused by mosaicism and microdiversity. Current plasmid assemblers rely on detecting circular paths in single-sample assembly graphs but face limitations because of graph fragmentation, entanglement and low coverage. We introduce PlasMAAG (plasmid and organism metagenomic binning using assembly–alignment graphs), a method to recover plasmids and cellular genomes from metagenomic samples. PlasMAAG complements assembly graph signals across samples by generating an ‘assembly–alignment graph’, which is used alongside common binning features for improved plasmid reconstruction. On synthetic benchmark datasets, PlasMAAG reconstructed 50–121% more near-complete plasmids than competing methods and improved the Matthews correlation coefficient of geNomad contig classification by 28–106%. On hospital sewage samples, PlasMAAG outperformed competing methods, reconstructing 33% more plasmid sequences. PlasMAAG enables the study of organism–plasmid associations and intraplasmid diversity across samples.",
      "children": []
    },
    {
      "title": "Main",
      "level": 1,
      "content": "Plasmids are extrachromosomal DNA molecules within a host cell that are physically separated from chromosomal DNA and can replicate independently. Plasmids differ in genome length, copy number, replication mechanism and conjugation mode. The part of the plasmid that encodes the core replication machinery is typically contiguous and is called the ‘backbone’. The replication and maintenance of plasmids incur a metabolic burden for the host and, to avoid purifying selection, the plasmid must carry additional ‘cargo’ genes that increase the fitness of either the host or the plasmid. These may be genes that confer antibiotic resistance.\n\nApproximately 50% of bacteria carry one or more plasmids. Nonetheless, in databases, sequences from plasmids remain underrepresented compared to those from cellular genomes. For instance, RefSeq ( [https://www.ncbi.nlm.nih.gov/refseq/](https://www.ncbi.nlm.nih.gov/refseq/)) contains 82,471 bacterial genomes but only 7,892 plasmids. Characterization of environmental plasmids in in vitro conditions is inherently limited by the ‘cultivation bottleneck’, where laboratory conditions modify microbial diversity, offering a poor representation of the original composition. Therefore, despite the great number of plasmid-related studies, most studies have investigated plasmid virulence and properties in isolated strains. This mismatch between estimated plasmid prevalence in bacteria and plasmid representation in the databases emphasizes our incomplete understanding of the plasmid genetic structure, diversity, and function.\n\nMetagenomics offers culture free alternative techniques; however, the genetic complexity of environmental samples complicates the process. In addition to the challenges of assembling bacterial chromosomes, assembly of plasmids brings other challenges. First, plasmids undergo frequent recombination, creating groups of plasmids that share a backbone but diverge on their cargo sequence. Second, plasmids at high copy number have higher mutation rates than chromosomes, which increases microdiversity and makes them difficult to assemble with de Bruijn graph-based assemblers. Third, plasmids are enriched for repeated sequences associated with transposable elements. A consequence of this is that plasmid sequences will be fragmented across assemblies and entangled by sharing the same backbone and repeated genetic elements.\n\nTo overcome these challenges, dedicated metagenomic plasmid assemblers such as Recycler, metaplasmidSPAdes and SCAPP have been developed. These methods rely on the assembly graph, a data structure used by metagenome assemblers, that represents overlaps between sequencing reads. Assembly graphs represent contiguous sequences (contigs) as nodes and overlaps between these as edges. By leveraging assembly graphs, plasmid assemblers can identify connected sequences and resolve complex genomic regions. Common to existing methods is that they operate on single-sample assembly graphs, using the circularity of plasmids and contig coverage. However, the methods have fundamental limitations. First, low coverage causes the ‘fragmentation problem’, where some plasmids appear disconnected in the graph, making them impossible to identify by graph peeling. Second, the high recombination rate of plasmids causes entangled assembly graph structures that thwart the graph cycle detection approaches of MetaplasmidSPAdes and SCAPP. Lastly, SCAPP and metaplasmidSPAdes leverage plasmid gene signatures to guide the plasmid candidate’s path extraction from the assembly graph, making them less sensitive to uncharacterized plasmids.\n\nBinning is a computational strategy used to reconstruct genomes by grouping contigs on the basis of their genome of origin, providing an alternative to assembly graph-based methods. Modern binners typically integrate several sequence features, including k -mer composition, abundance patterns across samples, assembly graph connectivity and taxonomic markers or annotations. Most of these features can be computed on a per-sequence basis and are, therefore, not vulnerable to the fragmentation problem suffered by assembly graphs with low coverage. Furthermore, it has been shown how binning information can be used to refine contig classification, using binning features to guide classification rather than contig classification to reconstruct the original sequences. We previously developed the binning tool VAMB (variational autoencoder (VAE) for metagenomic binning), which combines several of these features using a VAE into a latent space that is clustered to form bins.\n\nHere, we introduce assembly–alignment graphs (AAGs), which combine intrasample sequence overlaps recorded by assembly graphs with cross-sample overlaps detected by ordinary sequence alignment. Using a contrastive learning approach, we integrated AAGs with standard binning features in a new binning framework called PlasMAAG that can reconstruct both plasmids and cellular genomes. Across simulated and real datasets, PlasMAAG consistently outperformed existing binning approaches, particularly improving plasmid reconstruction while maintaining competitive performance on cellular genomes. In hospital sewage samples, PlasMAAG recovered substantially more plasmid sequences than other tools, validated using paired long-read and short-read data. By jointly reconstructing plasmids and their hosts, PlasMAAG enables downstream analyses of host–plasmid associations and plasmid diversity across samples. PlasMAAG supports ‘multisample’ characterization of both plasmids and cellular genomes, achieving state-of-the-art plasmid reconstruction with reduced computational requirements.",
      "children": []
    },
    {
      "title": "Results",
      "level": 1,
      "content": "",
      "children": [
        {
          "title": "Overview of PlasMAAG",
          "level": 2,
          "content": "The PlasMAAG pipeline is designed to recover plasmids and cellular genomes from metagenomics samples (Fig. (/articles/s41587-026-03005-7#Fig1)). Compared to our previous developed binning algorithm VAMB, PlasMAAG introduces three novelties. First, we use contig alignment graphs to combine per-sample assembly graphs from several samples into a single graph called an AAG. The AAG is then projected to an embedding space with fastnode2vec, from which communities of contigs can be extracted. Second, we enhanced the training of the VAE by adding contrastive learning on the basis of information from the AAG. Third, we use binning to ensemble geNomad contig annotation scores across bins to classify the bins into plasmid or cellular genomes.\n\nFig. 1: PlasMAAG workflow overview. [/articles/s41587-026-03005-7/figures/1](/articles/s41587-026-03005-7/figures/1) PlasMAAG leverages assembly graphs, alignment graphs, k -mer signal and contig coabundances for binning, with a final step where bins are classified as cellular or plasmid bins on the basis of refined geNomad predictions. a, Per-sample assembly graphs are merged with the between-sample alignment graph, generating the AAG. b, Fastnode2vec is used to generate contig embeddings from the AAG, from where contig communities are extracted. Communities are expanded, merged and purified using a VAE with contrastive loss that pushes communities toward being preserved in the embedding. TNF, tetranucleotide frequency. c, Plasmid and cellular candidate bins are extracted from the VAE embedding on the basis of their geNomad scores, using distinct plasmid and cellular clustering strategies. [Full size image](/articles/s41587-026-03005-7/figures/1)",
          "children": []
        },
        {
          "title": "PlasMAAG reconstructed 21–212% more plasmid bins compared to SCAPP confident",
          "level": 2,
          "content": "To develop and test PlasMAAG, we reassembled the simulated Critical Assessment of Metagenome Interpretation 2 (CAMI2) short-read human microbiome toy datasets. Reassembly of CAMI2 was required because the original CAMI2 plasmids were not simulated as independent entities from their hosts cellular genomes and because assembly graphs were not available ( [Methods](/articles/s41587-026-03005-7#Sec13)). In our analysis, we explicitly consider plasmids and cellular genomes as separate entities that are binned independently. We found that PlasMAAG reconstructed 5–64% more near-complete (NC) bins and 10–57% more medium-quality (MQ) bins (≥0.9 precision, ≥0.5 recall) over all five benchmark datasets compared to VAMB, the second-best-performing binner on the benchmark data (Fig. [2a](/articles/s41587-026-03005-7#Fig2) and Supplementary Fig. [1a](/articles/s41587-026-03005-7#MOESM1)). The improvement in binning performance was driven by increased reconstruction of plasmids, where PlasMAAG reconstructed 50–121% (41–102%) more NC (MQ) plasmids candidate bins compared to SemiBin2, ComeBin, MetaBAT2, MetaDecoder, CONCOCT and VAMB across all benchmark datasets. When compared to SCAPP, PlasMAAG reconstructed 14–40% (17–45%) more NC (MQ) plasmids than SCAPP cycles over 4/5 (5/5) benchmark datasets (Fig. [2b](/articles/s41587-026-03005-7#Fig2) and Supplementary Fig. [1b](/articles/s41587-026-03005-7#MOESM1)). When evaluating confident plasmids bins generated by PlasMAAG (above the 0.95 geNomad plasmid threshold), PlasMAAG reconstructed 21–212% (50–171%) more NC (MQ) plasmid bins than SCAPP confident (Fig. [2c](/articles/s41587-026-03005-7#Fig2) and Supplementary Fig. [1c](/articles/s41587-026-03005-7#MOESM1)). To check whether PlasMAAG’s accuracy stems only from its use of geNomad to identify plasmid contigs, we compared PlasMAAG to a workflow where geNomad was used to identify high-confidence plasmids in SCAPP cycles. However, PlasMAAG still outperformed this workflow, reconstructing 2–57% more NC plasmids and 6–44% more MQ plasmids across 4/5 and 5/5 benchmark datasets, respectively. (Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1)). Overall, these results show that PlasMAAG consistently outperforms existing binning tools in reconstructing plasmids.\n\nFig. 2: PlasMAAG binning and classification performance across the benchmark datasets. [/articles/s41587-026-03005-7/figures/2](/articles/s41587-026-03005-7/figures/2) a, NC bins (cellular genomes + plasmids) reconstructed from the five benchmark datasets for VAMB, MetaBAT2, SemiBin2, MetaDecoder, ComeBin, SCAPP cycles, CONCOCT and PlasMAAG. b, NC plasmid bins reconstructed by all methods. c, NC plasmids reconstructed by SCAPP confident and PlasMAAG confident. d, Set of NC unique plasmids reconstructed only by PlasMAAG confident (red), only by SCAPP confident (green) and by both methods (light brown) across all datasets. e, Same as d, but for MQ plasmid bins. f, NC cellular bins reconstructed by all methods except SCAPP confident. g, Plasmid sample purity and recovery rate from the airways dataset for PlasMAAG across geNomad thresholds (dark red), PlasMAAG confident (dark-red star), geNomad across thresholds (green), geNomad at the default plasmid threshold (green cross), SCAPP cycles (light yellow) and SCAPP confident (dark yellow). h, Sample F 1 across the five benchmark datasets for geNomad at the default plasmid threshold (green), SCAPP confident (yellow) and PlasMAAG confident (dark red). i, AUPRC for the classification of plasmids by geNomad (green) and when aggregating the geNomad scores per PlasMAAG community-based clusters (dark red). j, MCC for the classification of plasmids by geNomad (green) and when aggregating the geNomad scores per PlasMAAG community-based clusters (dark red). [Source Data](/articles/s41587-026-03005-7#MOESM4) [Full size image](/articles/s41587-026-03005-7/figures/2)",
          "children": []
        },
        {
          "title": "PlasMAAG provides a comprehensive and accurate characterization of microbial communities",
          "level": 2,
          "content": "In addition to reconstructing more plasmids, the PlasMAAG confident set of plasmids also spanned a larger plasmid diversity, as the unique set of confident PlasMAAG plasmids across the benchmark datasets included 172 NC plasmid bins and 223 MQ plasmid bins not reconstructed by SCAPP confident. By contrast, SCAPP confident reconstructed 64 NC plasmid bins and 68 MQ plasmid bins not reconstructed by PlasMAAG. The intersecting set of plasmids reconstructed by both methods was 164 NC and 185 MQ plasmid bins, respectively (Fig. [2d,e](/articles/s41587-026-03005-7#Fig2)). PlasMAAG was also competitive at reconstructing cellular genomes, reconstructing only 0.7–12% fewer NC cellular bins than VAMB or CONCOCT, the best cellular binners on benchmark datasets (Fig. [2f](/articles/s41587-026-03005-7#Fig2)), and 1–4% more MQ cellular bins over 3/5 benchmark datasets (Supplementary Fig. [1d](/articles/s41587-026-03005-7#MOESM1)). The set of PlasMAAG confident plasmids offered a better balance than SCAPP confident between the plasmid purity and recovery rates ( [Methods](/articles/s41587-026-03005-7#Sec13)) over the benchmark datasets, with a 14–43% improvement in F 1 (Fig. [2g,h](/articles/s41587-026-03005-7#Fig2), Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1) and Supplementary Note (/articles/s41587-026-03005-7#MOESM1)). This improvement was more pronounced in underexplored environments with fewer known plasmids, such as the CAMI2 marine dataset, where PlasMAAG achieved an F 1 score 80% higher than SCAPP (Supplementary Note (/articles/s41587-026-03005-7#MOESM1) and Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1)). The PlasMAAG pipeline averages geNomad scores across sequences deemed likely to belong together improving classification compared to applying geNomad on individual contigs. This yielded an improvement in plasmid/nonplasmid contig classification area under the precision–recall curve (AUPRC) and Matthews correlation coefficient (MCC) of 28–69% and 42–131%, respectively (Fig. [2i,j](/articles/s41587-026-03005-7#Fig2), Supplementary Note (/articles/s41587-026-03005-7#MOESM1), Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1) and Supplementary Table (/articles/s41587-026-03005-7#MOESM1)). By covering a broader range of plasmids, accurately reconstructing cellular genomes and achieving a better balance between plasmid purity and recovery rates, PlasMAAG provides a more comprehensive yet precise characterization of microbial communities.",
          "children": []
        },
        {
          "title": "AAGs integrate alignments and assembly graphs across samples",
          "level": 2,
          "content": "Assembly graphs encode sequence overlaps between contigs known to provide valuable signals for binning. In this work, we enhanced assembly graphs to strengthen their binning signal in two steps. First, we applied an edge-weighting scheme to emphasize connections between taxonomically related contigs in assembly graphs (Fig. [3a,b](/articles/s41587-026-03005-7#Fig3), Supplementary Note (/articles/s41587-026-03005-7#MOESM1), and Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1)). Second, because assembly graphs only connect contigs from within a single sample, we aggregated them across samples by constructing an alignment graph, where edges link contigs on the basis of alignment information (Fig. [3c,d](/articles/s41587-026-03005-7#Fig3) Supplementary Figs. (/articles/s41587-026-03005-7#MOESM1) and (/articles/s41587-026-03005-7#MOESM1) and Supplementary Note (/articles/s41587-026-03005-7#MOESM1)). As assembly graphs edges and alignment graph edges are complementary, we could trivially merge the graphs by adding the edges from one graph into the other, thus creating the AAG. We evaluated the edges in the AAGs across the benchmark datasets to assess whether higher edge weights correspond to contigs that are taxonomically close, such as those from the same genome. We found that this was the case with AUPRCs of 0.69–0.90 (0.93–0.97) across the benchmark datasets at genome (species) taxonomic level (Fig. [3f](/articles/s41587-026-03005-7#Fig3) and Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1)). Consistent with this, we found a positive correlation between the averaged edge weights and the average edge accuracy at genome taxonomic level, with 0.20–0.97 Spearman correlation coefficients across benchmark datasets (Fig. [3g](/articles/s41587-026-03005-7#Fig3) and Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1)). We then used fastnode2vec to project the AAG into numerical embeddings, from which we extracted communities of highly related contigs ( [Methods](/articles/s41587-026-03005-7#Sec13)). These AAG communities were precise but still represented only incomplete fragments of genomes (Fig. [3h](/articles/s41587-026-03005-7#Fig3), Supplementary Note (/articles/s41587-026-03005-7#MOESM1), upplementary Fig. (/articles/s41587-026-03005-7#MOESM1) and Supplementary Table (/articles/s41587-026-03005-7#MOESM1)). Thus, the AAG unifies assembly and alignment signals across samples into a graph whose edge weights capture taxonomic relationships, while fastnode2vec provides an efficient way to reduce this graph into embeddings that facilitate integration with other binning features.\n\nFig. 3: Assembly graph, alignment graph and AAG-based features for binning. [/articles/s41587-026-03005-7/figures/3](/articles/s41587-026-03005-7/figures/3) a, Average precision of the assembly graph edges from the airways benchmark dataset, sorted by edge weight and bucketed into 20 nonoverlapping, equal intervals from 0 to 1, is shown for genome (blue), species (orange) and genus (green) taxonomic levels. Genome, species and genus Spearman correlation P values = 1.81 × 10 −9, 1.06 × 10 −6 and 1.45 × 10 −16, respectively ( X = 20 buckets of edges). b, Precision–recall curve of the assembly graph edge weights from the airways benchmark dataset at genome (blue), species (orange) and genus (green) taxonomic levels. c, Alignment accuracy when increasing minimum identity thresholds across benchmark datasets. Results are shown only for restrictive alignments ( [Methods](/articles/s41587-026-03005-7#Sec13)) between contigs from different samples. d, Precision–recall curve of the alignment graph edge weights from the airways benchmark dataset at genome (blue), species (orange) and genus (green) taxonomic levels. e, Average precision of the alignment graph edges from the airways benchmark dataset, sorted by weight and grouped into 5% bins, is shown for genome (blue), species (orange) and genus (green) taxonomic levels. Genome, species and genus Spearman correlation P values = 2.1 × 10 − 6, 3.94 × 10 − 6 and 3 × 10 − 5, respectively ( X = 20 bins of edges). f. Precision–recall curve of the AAG edge weights from the airways benchmark dataset at genome (blue), species (orange) and genus (green) taxonomic levels. g, Average precision of AAG edges from the airways benchmark dataset, sorted by weight and grouped into 5% bins, is shown for genome (blue), species (orange) and genus (green) taxonomic levels. Genome, species and genus Spearman correlation P values = 1.09 × 10 − 12, 1.38 × 10 − 15 and 9.58 × 10 − 19, respectively ( X = 20 bins of edges). h, Precision distribution of communities extracted using fastnode2vec from AAGs across the five benchmark datasets at the genome taxonomic level. [Source Data](/articles/s41587-026-03005-7#MOESM4) [Full size image](/articles/s41587-026-03005-7/figures/3)",
          "children": []
        },
        {
          "title": "Contrastive VAEs improve binning through aggregating, merging and splitting communities",
          "level": 2,
          "content": "To address genome fragmentation in the AAG communities, we leveraged traditional binning features such as contig k -mer composition and abundances. In the VAMB framework, contig features are embedded using a VAE and these embeddings are then used for clustering contigs. PlasMAAG follows the same approach but also considers community structure during the embedding and clustering process. To encourage contigs of the same community to be close in the embedding while allowing contigs from different communities to be close in latent space when supported by other signals, we modified the VAE loss function. Specifically, we added a contrastive loss term that penalized large embedding distance between contigs of the same community. We then applied a clustering strategy on the embeddings, consisting of three key steps: (1) merging, where communities close in the embedding were merged to reduce genome fragmentation; (2) splitting, where communities with contigs placed far apart in the embedding were split up to increase precision; (3) expansion, where unassigned contigs located close to a community in latent space were added to the community to improve recall. We refer to these three steps as ‘community-based’ clustering ( [Methods](/articles/s41587-026-03005-7#Sec13) and Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1)). This community-based clustering resulted in a 46–102% increase in genome recall across benchmark datasets compared to the raw communities, confirming the effectiveness of these steps. The splitting step improved precision by 0.03–1% (Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1) and Supplementary Table (/articles/s41587-026-03005-7#MOESM1)), indicating minor but positive impact without compromising recall. On the other hand, community expansion had limited effect, with only a 1–3% increase in community size (Supplementary Table (/articles/s41587-026-03005-7#MOESM1)), suggesting that step 3 had a smaller impact. As recall increased and precision slightly improved, F 1 scores also increased, along with the number of reconstructed NC bins. Additionally, we evaluated the impact of including the contrastive loss term into the VAE on binning when clustering the embeddings with either the VAMB original density-based clustering or the community-based clustering. Across datasets, the contrastive loss substantially increased F 1 scores and had an overall positive effect on the number of NC bins (Supplementary Note (/articles/s41587-026-03005-7#MOESM1) and Supplementary Figs. (/articles/s41587-026-03005-7#MOESM1) and (/articles/s41587-026-03005-7#MOESM1)). Together, these results indicate that genome reconstruction benefited from latent representations informed by AAG-derived communities.",
          "children": []
        },
        {
          "title": "Plasmids and cellular genomes require distinct clustering strategies",
          "level": 2,
          "content": "We found that cellular genomes, likely because of their larger sizes, were fragmented across more AAG-derived communities compared to plasmids. In addition, plasmids and cellular genomes showed distinct patterns in k -mer composition, contig coabundance and PlasMAAG latent representations. Together, these differences suggested that community-based clustering was more appropriate for plasmid binning, whereas density-based clustering was more appropriate for cellular genomes (Supplementary Note (/articles/s41587-026-03005-7#MOESM1), Supplementary Figs. (/articles/s41587-026-03005-7#MOESM1) – (/articles/s41587-026-03005-7#MOESM1) and Supplementary Tables (/articles/s41587-026-03005-7#MOESM1) and (/articles/s41587-026-03005-7#MOESM1)). Because community-based clustering relied on AAG-derived features, we further explored how sample number and intersample similarity affected PlasMAAG’s performance. We found that larger and homogeneous sample sets led to improved binning accuracy and sample characterization (Supplementary Note (/articles/s41587-026-03005-7#MOESM1) and Supplementary Figs. (/articles/s41587-026-03005-7#MOESM1) and (/articles/s41587-026-03005-7#MOESM1)). Therefore, to identify and extract potential plasmids from the communities, we used geNomad to assign plasmid scores to each community-based cluster. We found that averaging geNomad scores across communities led to more accurate plasmid identification than scoring individual contigs (Supplementary Note (/articles/s41587-026-03005-7#MOESM1), Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1) and Supplementary Table (/articles/s41587-026-03005-7#MOESM1)). This enabled us to extract communities as putative plasmid bins with the community-based clustering and to remove plasmid contigs from the density-based clusters. We further observed that the plasmid and cellular extraction was sensitive to the geNomad threshold, particularly for cellular genomes (Supplementary Note (/articles/s41587-026-03005-7#MOESM1) and Supplementary Figs. (/articles/s41587-026-03005-7#MOESM1) and (/articles/s41587-026-03005-7#MOESM1)). For example, applying a geNomad plasmid threshold of 0.7 resulted in a reduction in NC cellular genomes (plasmids) of 6–39% (3–18%) (Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1)). This indicated a trade-off between plasmid extraction and cellular genome recovery. Importantly, in datasets where we added phages to plasmids and chromosomes, our approach remained robust, leading to reduced viral contamination while maintaining comparable plasmid reconstruction performance (Supplementary Note (/articles/s41587-026-03005-7#MOESM1), Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1) and Supplementary Table (/articles/s41587-026-03005-7#MOESM1)). Lastly, we evaluated whether PlasMAAG’s plasmid reconstruction exhibited biases related to biological features such as gene content, copy number or plasmid length. Across the benchmark datasets, we observed no clear bias toward plasmids carrying transposons, insertion sequences or antibiotic resistance genes nor toward specific plasmid copy number intervals or plasmid lengths below 350 kb. However, we did find that reconstruction rates were lower for very large plasmids exceeding 500 kb (Supplementary Note (/articles/s41587-026-03005-7#MOESM1) and Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1)). Together, these results demonstrate that explicitly accounting for the different community structure of plasmids and cellular genomes enables robust plasmid reconstruction while balancing plasmid and cellular genome recovery.",
          "children": []
        },
        {
          "title": "Validating PlasMAAG plasmid binning using paired short-read and long-read samples",
          "level": 2,
          "content": "Validating PlasMAAG binning performance on real data is challenging because existing tools do not provide quality estimates for plasmids and may be biased in poorly characterized environments. To address this, we designed a validation strategy based on five sewage samples from Denmark sequenced both with short-read and long-read sequencing. This paired dataset enabled us to use long-read contigs to evaluate bins generated from the short-read assemblies (Fig. [4a](/articles/s41587-026-03005-7#Fig4)). Using this approach, PlasMAAG community-based bins reconstructed 117% more long-read contigs than VAMB, the second-best-performing binner (Fig. [4b](/articles/s41587-026-03005-7#Fig4)). This improved performance remained consistent even after accounting for incompleteness in the long-read assembled contigs (Supplementary Note (/articles/s41587-026-03005-7#MOESM1) and Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1)). To further assess plasmid binning performance, we additionally evaluated reconstruction against plasmid-enriched sequencing data of the five sewage samples (plasmidomics). Here, PlasMAAG reconstructed 33 NC long-read plasmid contigs, corresponding to 22% more than the second best binner VAMB and 136% more NC plasmids than SCAPP cycles (Fig. [4b](/articles/s41587-026-03005-7#Fig4)). However, identification of plasmid bin candidates remained challenging, as geNomad assigned low plasmid scores to many long-read contigs supported by the plasmidomics data, suggesting that a considerable diversity of plasmids remains to be discovered. On the other hand, cellular genome reconstruction was unaffected by geNomad filtering, with PlasMAAG showing competitive cellular genome binning performance (Fig. [4b–d](/articles/s41587-026-03005-7#Fig4), Supplementary Figs. (/articles/s41587-026-03005-7#MOESM1) and (/articles/s41587-026-03005-7#MOESM1) – (/articles/s41587-026-03005-7#MOESM1) and Supplementary Notes (/articles/s41587-026-03005-7#MOESM1) and (/articles/s41587-026-03005-7#MOESM1)). Together, these results demonstrate that PlasMAAG delivered superior binning performance on real datasets, particularly for plasmid sequences, while highlighting that geNomad-based plasmid identification should be used with caution.\n\nFig. 4: PlasMAAG on real samples from hospital sewage. [/articles/s41587-026-03005-7/figures/4](/articles/s41587-026-03005-7/figures/4) a, Overview of the strategy used to validate PlasMAAG on the five hospital sewage samples. For each sample, long-read metagenomics, short-read metagenomics and short-read plasmidomics datasets were generated. LR, long-read; SR, short-read. PlasMAAG was applied to the short-read metagenomics data to produce candidate plasmid and cellular bins. These bins were validated against a reference assembly composed by long-read contigs to assess overall binning performance and against a second reference assembly constructed from long-read contigs with plasmid evidence, identified by either circularity or plasmidomics read coverage. b, Binning performance of all methods across the five sewage samples, evaluated using all long-read contigs (red) and long-read contigs with plasmid evidence (blue). PlasMAAG dens. bins produced using VAMB’s density-based clustering algorithm on PlasMAAG’s latents; PlasMAAG coms. bins generated using the community-based clustering algorithm. c, Binning performance of PlasMAAG, SCAPP and MetaPlasmidSPAdes under relaxed (light gray) and strict (dark gray) plasmid filtering criteria. d, NC cellular bins according to CheckM2 estimates, produced by all organism binners for the five hospital sewage samples. PlasMAAG non-plas. conf. PlasMAAG density-based bins after extracting candidate plasmid contigs by aggregating geNomad plasmid contig scores per PlasMAAG community-based clusters ( [Methods](/articles/s41587-026-03005-7#Sec13)). [Source Data](/articles/s41587-026-03005-7#MOESM4) [Full size image](/articles/s41587-026-03005-7/figures/4)",
          "children": []
        },
        {
          "title": "Identification of host–plasmid associations from hospital sewage environments",
          "level": 2,
          "content": "By reconstructing plasmid and cellular genomes from the same set of samples, PlasMAAG enables integrated host–plasmid analyses. To illustrate this, we investigated host–plasmid abundance correlations of 24 short-read-based hospital sewage samples collected in Spain ( [Methods](/articles/s41587-026-03005-7#Sec13)). PlasMAAG reconstructed 27,954 candidate plasmid bins and 213,431 nonplasmid candidate bins. Leveraging the multisample design, plasmid bins were aggregated into 13,912 cross-sample clusters and putative bacterial hosts were assigned to each plasmid cluster using the Plasmid Database (PLSDB). In parallel, we identified 323 high-quality cellular organism bins (completeness ≥ 70%, contamination ≤ 10%) and, as with the plasmids, aggregated them across the samples. Using abundance information across samples, we identified a total of 825 significant positive correlations between plasmid and cellular clusters (adjusted P value < 0.05, two-sided test) (Fig. [5a](/articles/s41587-026-03005-7#Fig5)). Of these, 209 correlations were consistent with known host–plasmid associations at the phylum level according to PLSDB, 237 were inconsistent (involving plasmids known to associate with different phyla) and the remaining 379 could not be evaluated because they involved plasmid sequences with no match in PLSDB (Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1)). Some host–plasmid associations matched known and unknown patterns. For instance, cluster cl_20, annotated as belonging to the Aeromonas genus, correlated with up to 41 plasmid clusters, 12 of which were previously reported as known host–plasmid associations in PLSDB (Fig. [5a](/articles/s41587-026-03005-7#Fig5)). On the other hand, cluster cl_293, annotated as the Ruminococcus_E genus, correlated with 43 plasmid clusters, none of them previously reported in PLSDB (Fig. [5a](/articles/s41587-026-03005-7#Fig5)).\n\nFig. 5: PlasMAAG enables host–plasmid association studies and exploration of intraplasmid variation across environments, demonstrated using 24 hospital sewage samples. [/articles/s41587-026-03005-7/figures/5](/articles/s41587-026-03005-7/figures/5) a, Spearman correlation between PlasMAAG high-quality cellular clusters and PlasMAAG plasmid clusters with an aggregated geNomad plasmid score above 0.75. Highlighted cells with bold rectangles indicate significant correlations after Benjamini–Hochberg false discovery rate correction. Cells marked with ‘X’ represent plasmid–organism associations previously reported in PLSDB. The organism cluster dendrogram was generated using GTDB-tk taxonomic annotations, while the plasmid cluster dendrogram was based on abundance correlations. b, PlasMAAG plasmid cluster nneighs_416 bins. Each row represents a bin from one sample and numbers within parenthesis indicate median bin depth. Yellow blocks denote contigs aligned to pAsa4c, sorted by alignment position. Dark-green blocks represent contigs not mapping to pAsa4c ( [Methods](/articles/s41587-026-03005-7#Sec13)), with their positions inferred from matches to other PLSDB plasmid accessions. Light-green sections withing dark-green blocks indicate alignment segments to pAsa4c. Dark-gray areas indicate alignment graph edges and light-gray areas represent nonrestrictive alignment matches. GC%, average G+C content computed using a 1,000-kb window. Color code for pAsa4c regions: blue, replication and maintenance; green, conjugative transfer; purple, recombination and DNA repair; orange, secretion and surface structures; red, metabolism; yellow, enzymes; cyan, regulatory proteins and transcription factors; brown, transposases and mobile genetic elements; gray, hypothetical or unclassified. c, PlasMAAG plasmid cluster nneighs_416, composed of contigs from sample 6 (blue), sample 3 (red), sample 5 (green) and sample 23 (orange). Links represent alignment regions, colored according to the sample of origin. Bold annotations indicate functions associated to antimicrobial resistance. [Source Data](/articles/s41587-026-03005-7#MOESM4) [Full size image](/articles/s41587-026-03005-7/figures/5)",
          "children": []
        },
        {
          "title": "Studying intraplasmid variation across hospital sewage samples",
          "level": 2,
          "content": "In PlasMAAG, contigs from different samples are projected into a shared latent space, enabling them to be clustered together and split into per-sample bins thereafter. Analysis of these cross-sample clusters enabled investigation of highly related plasmids from different samples and bins from the same plasmid cluster could be explored using the alignments from the AAG. To illustrate this, we selected plasmid cluster nneighs_76 for a more in-depth analysis. Plasmid bins from the nneighs_76 cluster reconstructed a 90-kb region similar to the plasmid pAsa4c, which is reported to be hosted by Aeromonas salmonicida subsp. salmonicida (Fig. [5b](/articles/s41587-026-03005-7#Fig5)). Despite representing highly overlapping regions of the same accession, sample-specific bins from the nneighs_76 cluster exhibited varying degrees of contig fragmentation. For instance, the bin from sample 2 was composed of 20 contigs, whereas the bin from sample 1 consisted of ten contigs, which could be explained by the difference in the plasmid abundance in different samples. We then explored the relationship of the plasmid bins using the alignments from the AAG and found that some bins in nneighs_76 contained contigs that did not align to pAsa4c (Fig. [5b](/articles/s41587-026-03005-7#Fig5)). Several of these unaligned contigs were found in multiple bins and were syntenic across bins aligned to each other, suggesting that we found true plasmid variation and not an error in binning (Fig. [5b](/articles/s41587-026-03005-7#Fig5)). Using synteny and the AAG, we could identify four approximate locations in the reference sequence where these contigs could be located. Three of four regions had hallmarks of recombination hotspots, including an ISAs2 insertion site, a known conjugative block and a segment with distinct G+C content (Fig. [5b](/articles/s41587-026-03005-7#Fig5)). Furthermore, 14 of 19 contigs not mapping to pAsa4c aligned to plasmid accessions reported to be hosted by organisms from the Aeromonas genus, consistent with the pAsa4c original host and supporting the findings. Additionally, PlasMAAG clusters, in combination with the AAG, enabled the exploration of diversity among similar plasmids across samples without PLSDB support. As an example, sample-specific bins from the plasmid cluster nneighs_416 exhibited a high degree of sequence similarity despite variations in contig fragmentation (Fig. [5c](/articles/s41587-026-03005-7#Fig5)). In conclusion, PlasMAAG facilitates the tracking of highly similar plasmids across different environments, allowing for the capture of their composition variations.",
          "children": []
        }
      ]
    },
    {
      "title": "Discussion",
      "level": 1,
      "content": "Plasmids are pivotal in horizontal gene transfer, with an influential role in shaping microbial communities. Their prevalence across microbial ecosystems highlights their importance, yet studying plasmids from environmental samples has been challenging because of their dynamic and unstable composition, as evidenced by the lack of groundbreaking plasmid binners in recent years. This limitation has hindered efforts to bin and identify plasmids accurately, despite their abundance. The decrease in sequencing costs has greatly increased the availability of metagenomic samples, presenting an unprecedented opportunity to uncover plasmid diversity. However, the challenges of plasmid binning emphasize the need for a robust and broad-range plasmid binning method.\n\nIn this study, we introduced PlasMAAG, a deep-learning-based method for metagenomic binning of both plasmids and cellular genomes. PlasMAAG uses a unique feature we developed, AAGs, which enables the aggregation of assembly graphs across multiple samples. This advancement allows PlasMAAG to overcome traditional limitations associated with single-sample plasmid assemblers.\n\nPlasMAAG outperformed SCAPP, the current state-of-the-art plasmid assembler, on both synthetic and real datasets, delivering superior results for plasmid binning while being substantially faster. In addition to producing more plasmid bins, the set of candidate plasmids produced by PlasMAAG achieved a more balanced trade-off between plasmid purity and recovery rates, enabling a broader characterization of metagenomic samples. However, it is important to note that SCAPP is not a binner but a plasmid assembler focused on generating complete circular contigs. As such, its goal is different from that of PlasMAAG, which aims to bin plasmid fragments into coherent groups.\n\nPlasMAAG’s capability to bin both plasmids and organisms offers a comprehensive approach to metagenomic analysis. PlasMAAG achieves organism binning results that are comparable to leading organism binners on synthetic datasets and real-world environmental datasets. PlasMAAG’s holistic approach enables integrated studies, such as the exploration of plasmid–host associations. Using its comprehensive binning capabilities, we gathered abundance-correlation-based evidence for 825 plasmid–host associations, with only 4% previously reported in PLSDB. However, these associations are merely based on abundance correlation; thus, we expect a substantial fraction of them to be spurious. Studies of host–plasmid associations could use PlasMAAG correlations as a starting point but would need more evidence. By contrast, PlasMAAG’s AAG-based clustering robustly revealed intraplasmid variation across samples, enabling the study of plasmid sequence variation across environments. Nevertheless, we expect PlasMAAG to be poor at recovering within-sample intraplasmid variation because of limited preservation of microdiversity by short-read assemblers such as metaSPAdes and difficulty in accurately estimating abundance of many near-identical contigs within a single sample.\n\nWe demonstrated that geNomad plasmid predictions were enhanced when aggregated across PlasMAAG communities, underscoring the value of binning for refining plasmid sequence identification. However, we also found that geNomad was inaccurate when applied to understudied environments, as validated by experimental paired metaplasmidomics, long-read and short-read data. These discrepancies highlight the need for more robust plasmid sequence identification methods capable of handling complex or uncharted environments.\n\nThe success of PlasMAAG is largely attributable to the AAG, a feature that complements assembly graph signals across samples in a multisample framework. This innovation not only enhances binning accuracy but also facilitates the inference of compositional similarities between samples. Moreover, AAGs also improve binning of contigs from the same sample by indirectly linking within-sample contigs through between-sample intermediaries.\n\nAnother notable innovation in PlasMAAG is its use of contrastive loss to integrate traditional binning features, such as k -mer composition and contig abundances, with the AAG. This approach could be extended to incorporate other graph-like data in the binning process, such as Hi-C data. As sequencing technologies advance and contigs become decreasingly fragmented, particularly in long-read datasets, the utility of using cross-sample alignments to bridge gaps in the assembly graphs will grow, covering larger genome fractions and providing richer insights.\n\nBy enabling the study of plasmids alongside cellular genomes from highly complex samples, PlasMAAG expands our ability to explore microbial communities comprehensively. Its focus on plasmids, an often-overlooked but critical component of microbial ecosystems, enhances our understanding of their role in horizontal gene transfer and microbial community dynamics.\n\nIn conclusion, PlasMAAG represents a step forward in plasmid and organism binning from metagenomic samples. By incorporating AAGs and contrastive learning, it addresses longstanding challenges in plasmid binning while providing a framework for studying plasmid–host associations and microbial community dynamics.",
      "children": []
    },
    {
      "title": "Methods",
      "level": 1,
      "content": "",
      "children": [
        {
          "title": "Overview of PlasMAAG",
          "level": 2,
          "content": "The inputs to the PlasMAAG pipeline are a set of reads per sample. Reads are assembled with metaSPAdes (version 3.15.5), creating an assembly graph and contigs for each sample. The contigs across all samples are concatenated together to create the contig catalog. Reads are mapped to the catalog with minimap2 (version 2.24) and SAMtools (version 1.18), creating per-sample BAM files. The alignment graph is generated by aligning the contigs across samples with the National Center for Biotechnology Information (NCBI) basic local alignment search tool (BLAST; version 2.15.0). The assembly and alignment graphs are merged into the AAG. Then, fastnode2vec (version 0.05), an optimized version of node2vec, is used to embed local AAG context of each contig into an embedding space. The k -mer composition and abundance features of contigs are embedding using a VAE, where an additional loss term is added, which penalizes distance between contigs of the same community. Using the VAE embeddings, communities are expanded, merged and purified. The geNomad tool (version 1.8.0) is used to separate plasmid from nonplasmid contigs; communities of plasmid contigs are extracted as separate bins, whereas the remaining contigs are extracted in bins using a clustering algorithm.",
          "children": []
        },
        {
          "title": "Benchmark datasets",
          "level": 2,
          "content": "We based our benchmark datasets on the existing CAMI2 human microbiome toy dataset, the CAMI2 marine dataset and the CAMI2 skin human microbiome dataset with addition of phage reads from 280 phage genomes from the Metagenomic Gut Virus (MGV) database (Supplementary Table (/articles/s41587-026-03005-7#MOESM1)). All CAMI2 datasets are publicly available short-read metagenomic benchmarks generated under the CAMI initiatives. The human dataset consists of five simulated environments: airways, gastrointestinal, oral, skin and urogenital, designed to mimic human microbiome communities, whereas the CAMI2 marine dataset represents a sea environment. For each sample, we simulated 5 Gbp of 2× 150-bp Illumina-like reads from the source genomes using the CAMISIM software. Compared to the original CAMI2 datasets, we had to make several changes. The original dataset did not provide assembly graphs; thus, we assembled the reads using metaSPAdes (version 3.15.5) and mapped the resulting contigs back to the CAMI2 source genomes or the MGV phage genomes to determine their origin using minimap2, accepting hits with an identity > 97% and a query coverage > 90%. Because this approach initially led to many unmapped or ambiguously mapping contigs because of overeager read correction in the assembler, we resimulated the reads using wgsim ( [https://github.com/lh3/wgsim](https://github.com/lh3/wgsim)) with zero sequencing errors and a default fragment size of 270 (mean) and disabled error correction in the assembler. Moreover, CAMI2 considered plasmids to be part of their cellular host genome with the same abundance, which would inhibit our abundance-based binning approach. Instead, we simulated plasmids as distinct genomes with their own abundance proportional to the host abundance, modulated by a Gaussian random variable that incorporates a plasmid copy number model, as performed previously. For the samples containing phages, phage abundances were sampled from a lognormal distribution with mean of 1 and s.d. of 4. Lastly, CAMI2 did not contain reads simulated from across the edges of the underlying circular sequences, which prevents assembly graph cycles and hobbles graph peeling-based approaches such as that used by SCAPP. We made sure to include such reads and enable circular contigs by simulating reads spanning the junction between the start and end positions of the genomes. Our reassembled CAMI2 human and marine datasets were, like the original CAMI2 datasets, composed of ten samples for all datasets except urogenital, which had nine. Our datasets had the following number of contigs after retaining only contigs larger than 2 kbp: airways, 35,537; gastrointestinal, 80,325; oral, 94,251; skin, 31,181; urogenital, 29,550; marine, 150,565; skin with phages, 34,979.",
          "children": []
        },
        {
          "title": "Assembly graph edge weighting",
          "level": 2,
          "content": "Assembly graphs were extracted from the assembly_graph_after_simplification.gfa file from metaSPAdes and converted into a NetworkX (version 3.4.2) directed graph, with contigs represented as nodes and links between segments in contigs represented as edges. To enrich the assembly graph signal for binning, graph edges were weighted with the normalized linkage metric, which is dependent on the number of links between any segments from each pair of contigs, normalized by the length of the contigs. For a pair of contigs c i, c j, the number of links connecting those contigs n _links ij and the contig lengths l c, normalized linkage is expressed as\n\n$$\\mathrm{normalized}\\,{\\mathrm{linkage}}_{{c}^{i}{c}^{j}}=\\frac{{n\\mathrm{\\_links}}_{{ij}}}{\\min ({l}^{{c}^{i}},{l}^{{c}^{j}})}$$",
          "children": []
        },
        {
          "title": "Alignment graph edge weighting",
          "level": 2,
          "content": "After assembly, contigs shorter than 2,000 bp were discarded, as described previously. Contigs were aligned all against all using NCBI BLAST using the ‘blastn’ command with ‘-perc_identity 95’, only keeping between-sample hits, alignment identity ≥ 98.0% and alignment ≥ 500 bp. We also removed alignments between sequences that contained large sections that did not align because of sequence diversity, as we wanted the alignments to represent shared sequences across samples. The remaining set of alignments after filtering was defined as ‘restrictive’ alignments. From the alignments, we created an alignment graph with contigs as nodes and alignments as edges. Edges were weighted with the normalized alignment metric to reflect the alignment certainty. For a pair of contigs c i, c j, alignment identity id, alignment length L and contig length l c, normalized alignment is expressed as\n\n$$\\mathrm{normalized}\\,{\\mathrm{alignment}}_{{c}^{i}{c}^{j}}=\\frac{\\mathrm{id}}{100}\\frac{\\min (L,{l}^{{c}^{i}},{l}^{{c}^{j}})}{\\min ({l}^{{c}^{i}},{l}^{{c}^{j}})}$$",
          "children": []
        },
        {
          "title": "AAG community extraction with fastnode2vec",
          "level": 2,
          "content": "Assembly and alignment graphs share no edges because their edges connect only within-sample and between-sample contigs, respectively. This allowed us to trivially merge the graphs by adding the edges from one graph into the other, thus creating the AAG. Thus, the AAG is a single graph that contains the nodes and edges from the individual assembly graphs and the alignment graph. We aimed to leverage this integrated graph to enhance the binning signal, while keeping all individual nodes (that is, contigs) intact and unchanged. To extract communities from the AAG, we first ran fastnode2vec on the AAG to obtain contig embeddings. We created a new graph by linking contigs within a cosine distance of 0.1 in embedding space, after which we defined each connected component to be a contig community. We optimized the fastnode2vec hyperparameters and clustering radius to generate pure communities at the genome level, running a small grid search over the resimulated CAMI2 airways dataset. The embedding dimensions, walk length, number of walks, window size, p and q parameters from fastnode2vec were set to 32, 10, 50, 10, 0.1 and 2.0, respectively.",
          "children": []
        },
        {
          "title": "Contrastive-VAMB for community merging and expansion",
          "level": 2,
          "content": "Contrastive-VAMB is a variation of the original VAMB model, with a modification on the loss function to account for the communities extracted from the fastnode2vec embeddings. Contrastive-VAMB is composed of an encoder, latent representation layer μ and a decoder. Each contig represented by the concatenation of the contig coabundances along samples C in, the tetranucleotide frequencies T in and the unnormalized contig abundances A in is passed to the encoder. While C in and T in were already used in the original VAMB model, the inclusion of A in is motivated by the observation that the normalization in the computation of C in removes abundance signal by removing a degree of freedom. This signal is reintroduced as A in. This way, the network explicitly models two distinct notions of abundance: how much abundance there is in total and how it is distributed among samples. The encoder projects the contigs into a latent normal N(μ, I) distribution parametrized by the μ layer, from which the decoder samples. The decoder is optimized to reconstruct C in, T in and A in from the instances sampled from N(μ, I), decrease the latent cosine distance between contigs with closely related fastnode2vec graph embeddings and decrease the deviance between the latent normal distribution N(μ, I) parametrized by the μ layer and the standard normal distribution used as a prior N(0, I).",
          "children": []
        },
        {
          "title": "Loss functions",
          "level": 2,
          "content": "The contrastive-VAMB loss can be decomposed in three terms: reconstruction loss, contrastive loss and regularization loss. The reconstruction loss ( L rec) penalizes the reconstruction error of A in, T in, and C in. Like in VAMB, the sum of squared error (SSE) loss was used for T in and cross-entropy (CE) loss was used for C in. For A in, PlasMAAG also uses SSE loss. These three terms are weighted with hyperparameters w A, w T and w C.\n\n$${L}_{\\mathrm{rec}}={w}_{{\\bf{A}}}\\mathrm{CE}\\left({{\\bf{A}}}_{\\mathrm{in}},{{\\bf{A}}}_{\\mathrm{out}}\\right)+{w}_{{\\bf{T}}}\\mathrm{SSE}\\left({{\\bf{T}}}_{\\mathrm{in}},{{\\bf{T}}}_{\\mathrm{out}}\\right)+{w}_{{\\bf{C}}}\\mathrm{SSE}\\left({{\\bf{C}}}_{\\mathrm{in}},{{\\bf{C}}}_{\\mathrm{out}}\\right)$$\n\nThe contrastive loss ( L contr) penalizes the cosine distance between the VAMB-latent representations contigs highly related in fastnode2vec embedding space when such cosine distance overcomes a predefined margin m, where m is a hyperparameter. For a contig ci and highly related fastnode2vec embedding space contigs H ci = { n 0,…, n n }, L contr is expressed as\n\n$${L}_{\\mathrm{contr}}=\\max \\left(\\frac{{\\sum }_{{n}_{i}\\in {H}^{ci}}\\mathrm{cosine}\\,\\mathrm{distance}\\left({{\\rm{m}}}^{ci},{{\\rm{m}}}^{{n}_{i}}\\right)}{\\left|{H}^{ci}\\right|}-m,0\\right)$$\n\nThe regularization loss ( L reg) penalizes the deviance between the latent normal distribution N(μ, I) parametrized by the μ layer and the standard normal distribution used as a prior N(0, I) with the Kullback–Leibler divergence; as the s.d. is set to 1, L reg can be simplified to\n\n$${L}_{\\mathrm{reg}}=\\frac{1}{2}+\\sum {{\\rm{\\mu }}}^{2}$$\n\nLastly, the model total loss ( L) was aggregated with weighting hyperparameters w L reg, and w L contr:\n\n$$L={L}_{\\mathrm{rec}}+{{w}_{{L}_{\\mathrm{reg}}}L}_{\\mathrm{reg}}+{{w}_{{L}_{\\mathrm{contr}}}+L}_{\\mathrm{contr}}$$",
          "children": []
        },
        {
          "title": "Clustering plasmid and organism candidates with geNomad",
          "level": 2,
          "content": "Two sequential strategies were implemented to cluster the latent space tailored to extract plasmids and nonplasmids. The clustering strategy is composed of two phases: community clustering and iterative medoid clustering, both using latent space cosine distances. Community clustering works in five steps (Supplementary Fig. (/articles/s41587-026-03005-7#MOESM1)). First, for each community extracted from the fastnode2vec embeddings, contigs belonging to the same community are linked and links between contigs with a VAE embedding cosine distance > 0.2 are removed. Second, contigs within 0.01 cosine distance are linked. Third, connected components are extracted as bins. Fourth, potentially circular contigs are detected by mapping read pairs, where mates map to opposite contig ends within 50 bp of the contig end. These are extracted to their own bins. Lastly, plasmid score is defined for each cluster by aggregating the geNomad plasmid contig scores with a contig length weighted mean, defining plasmid candidates when cluster scores are larger than the defined threshold. When the geNomad plasmid threshold is larger than 0.5, a fixed geNomad plasmid threshold of 0.5 is applied to the circular contigs, accounting for the circular evidence relatable to plasmids. The nonplasmid clustering strategy consists of two steps. First, the VAMB-latent space is clustered using the iterative medoid clustering algorithm from VAMB. Second, contigs belonging to any plasmid candidate cluster as defined by community-based clustering are removed. In summary, candidate plasmids are first identified using community-based clustering combined with geNomad cluster scoring. Contigs belonging to these plasmid bins are then removed from the bins generated by the density-based clustering strategy.",
          "children": []
        },
        {
          "title": "Binning benchmarking: CAMI2 reassembled",
          "level": 2,
          "content": "We compared the plasmid and organism binning performance of PlasMAAG version 1.0.0, VAMB version 4.1.3, CONCOCT version 1.1.0, MetaBAT2 version 2.12.1, SemiBin2 version 2.1.0, Comebin version 1.0.4, MetaDecoder version 1.0.19, SCAPP version 0.1.4 and MetaPlasmidSPAdes version 3.15.3 over the resimulated CAMI2 datasets. Binning performance was evaluated in terms of the total number of genomes recovered across all samples with precision ≥95% and recall ≥90% (so-called NC genomes). As PlasMAAG, VAMB, MetaBAT2, SemiBin2, Comebin and MetaDecoder perform the binning after assembling the contigs, precision and recall of the bins were obtained from the contig references using BinBencher (version 0.3.0). On the other hand, SCAPP and MetaPlasmidSPAdes assemble their own contigs. Here, we produced a ground truth by aligning the output bins to the origin genomes using NCBI BLAST 2.15.0 accepting hits with an identity >97% and a query coverage > 90%, after which we benchmarked using BinBencher.",
          "children": []
        },
        {
          "title": "Sample benchmarking: CAMI2 reassembled",
          "level": 2,
          "content": "Plasmid purity rate (PPR), plasmid recovery rate (PRR) and F 1 were computed for each set of plasmid candidates, reflecting the plasmid characterization at the sample level, not at the bin level. PPR was calculated as the fraction of candidate plasmids reconstructed above precision and recall thresholds in the total number of candidate plasmids output by the method. PRR was calculated as the fraction of candidate plasmids reconstructed above precision and recall thresholds divided by the total number of plasmids with coverage above the recall threshold. Given a sample ( s), a set of plasmid candidates (candidates), binning precision and binning recall thresholds (pre, rec) and the set of true plasmids present in the sample (plasmids) are related by the following expressions:\n\n$$\\begin{array}{l}{\\mathrm{PPR}}_{\\mathrm{candidates},\\mathrm{pre},\\mathrm{rec}=\\displaystyle \\frac{\\mathrm{no}.\\,\\mathrm{of}\\,\\mathrm{binner}\\,\\mathrm{plasmid}\\,\\mathrm{candidates} > (\\mathrm{pre}\\, \\mathrm{rec})}{\\mathrm{no}.\\,\\mathrm{of}\\,\\mathrm{binner}\\,\\mathrm{candidates}}}\\end{array}$$\n\n$${\\mathrm{PRR}}_{\\mathrm{candidates},\\,\\mathrm{plasmids},\\,\\mathrm{pre},\\,\\mathrm{rec}}=\\frac{\\mathrm{no}.\\,\\mathrm{of}\\,\\mathrm{binner}\\,\\mathrm{plasmid}\\,\\mathrm{candidates} > (\\mathrm{pre},\\,\\mathrm{rec})}{\\mathrm{no}.\\,\\mathrm{of}\\,\\mathrm{recoverable}\\,\\mathrm{plasmids}\\,\\mathrm{in}\\,\\mathrm{sample}}$$\n\nLastly, F 1 represents the harmonic mean between the PPR and PRR:\n\n$${{F}_{1}}_{\\mathrm{PPR},\\,\\mathrm{PRR}}=\\frac{2\\times \\mathrm{PPR}\\times \\mathrm{PRR}}{\\mathrm{PPR}+\\mathrm{PRR}}$$",
          "children": []
        },
        {
          "title": "Hospital sewage sample sequence datasets",
          "level": 2,
          "content": "Two biological datasets were used in this study to assess the quality of plasmid binning. Urban sewage samples (UWSs) were collected from comparable UWSs from Denmark and Spain located in Odense and Santiago de Compostela, as previously described. In this study, only hospital sewage samples from each location were used. Sewage samples were collected in the winter and summer of 2018 using ISCO automatic samplers for 24-h flow (50 ml per 5 min) in Denmark and using 24-h time-proportional samples in Spain (mixing hourly samples according to flow information) (Supplementary Table (/articles/s41587-026-03005-7#MOESM1)). Three replicates per site and season were collected on three consecutive days without rain. All samples were initially cooled with ice on site. Then, 100 ml of each sample was centrifuged at 10,000 g for 8 min at 4 °C in the laboratory. After removing supernatant, pellets were resuspended in 20% of glycerol stock to reach a final volume of 10 ml for storage at −80 °C. In total, environmental DNA was extracted from all samples using the NucleoSpin soil kit (Macherey-Nagel) using 500 μl of glycerol stock material for direct shotgun metagenomic using Illumina NovaSeq using 2× 150-bp paired-end mode (all 18 samples) and PacBio Sequel2e (five samples from Denmark). PacBio libraries were built from the same DNA extracts using libraries using SMRTbell express template 2.0 kit and Sequel II binding kit 3.2 (Pacific Bioscience) and barcoded using SMRTbell barcoded adaptor plate 3.0 (Pacific Bioscience). Two libraries per 8M SMRTcell (Pacific Bioscience) were pooled and sequenced on a PacBio Sequel2e instrument at the University of Copenhagen.\n\nFor plasmid-enriched samples, we used specific methods to deplete nonplasmid DNA as described previously. Briefly, hospital sewage samples were pretreated by filtration, vortex and sonication and resuspended in TE buffer. Afterward, a prelysis cocktail of cell-wall-degrading enzymes (lysozyme, mutanolysin and lysostaphin) was used to facilitate lysis of Gram-positive bacteria during alkaline lysis. Prelysis was followed by alkaline lysis to remove chromosomal DNA, followed by Plasmid-Safe ATP-dependent DNase (Lucigen) digestion. Plasmid-Safe DNase will digest any fragments of dsDNA with open 3′ or 5′ termini, thereby removing fragmented chromosomal DNA. The purified plasmid DNA was then quality-checked and libraries were prepared and sequenced on an Illumina NextSeq platform with a v2.5 sequencing kit (Illumina) in paired-end mode.",
          "children": []
        },
        {
          "title": "Binning benchmarking: hospital sewage",
          "level": 2,
          "content": "We compared the binning performance of PlasMAAG version 1.0.0, VAMB version 4.1.3, MetaBAT2 version 2.12.1, SemiBin2 version 2.1.0, Comebin version 1.0.4, CONCOCT version 1.1.0, MetaDecoder version 1.0.19, metaplasmidSPAdes version 3.15.3 and SCAPP version 0.1.4 on the hospital sewage samples. The dataset consisted of 147,437 short-read contigs assembled from five hospital sewage samples. Each sample was collected at a unique combination of time and location. To evaluate binning performance on these samples, we generated high-quality long-read sequences from the same samples using HiFi sequencing on a Pacific BioSciences Sequel II platform. We assembled the sequences to long-read contigs with hifiasm_meta version 0.3-r073. To determine which short-read contigs corresponded to long-read contigs, we mapped short-read contigs to long-read contigs using minimap2 version 2.24, handling rotated circular contigs by concatenating each long-read contig to itself. We accepted hits with an identity > 97% and a query coverage > 90%. To quantify short-read binning, we counted ‘NC long-read assemblies’ summed across all samples: long-read contigs where a bin of short-read contigs existed such that 90% of the long-read contig was covered with short-read contigs from that bin and 95% of the bin’s base pairs were mapped to no other long-read contig. To evaluate the overall binning performance, the entire set of long-read contigs was used to build the reference, whereas, to evaluate the plasmid binning performance, only the long-read contigs that were circular or with metaplasmidomics reads coverage > 50% were used. Metaplasmidomics short reads were derived from the same samples but underwent a filtering step to enrich for plasmids, thereby representing highly plasmid-enriched sequencing data. NC long-read assemblies were counted with BinBencher version 0.3.0 and NC cellular genomes were estimated with CheckM2 version 0.1.3.",
          "children": []
        },
        {
          "title": "Host–plasmid and intraplasmid diversity exploration",
          "level": 2,
          "content": "PlasMAAG was used to bin the contig sequences from hospital sewage samples from hospitals in Spain. The dataset consisted of n = 828,260 contigs assembled from n = 24 hospital sewage samples. Each sample was collected at a unique combination of time and location. PlasMAAG bins were aggregated into PlasMAAG clusters and classified as plasmids if the aggregated geNomad plasmid score exceeded 0.75. Only plasmids clusters with more than 150 kb were considered for the host–plasmid association. Organism bin quality was estimated with CheckM2 version 0.1.3 and only high-quality (completeness ≥ 70% and precision ≥ 90%) bins were kept. GTDB-tk (version 2.4.0) was used to estimate taxonomy for the high-quality bins, with cluster taxonomy assigned on the basis of majority vote. Abundance correlation analysis was conducted for plasmids and organism clusters with nonzero abundance over at least 18 of 24 overlapping samples. Spearman correlation coefficients and P values were computed using SciPy’s scipy.stats.spearmanr with default settings, which tests the alternative hypothesis of a nonzero correlation. To account for multiple testing, P values were corrected using the Benjamini–Hochberg, which attempts to correct the false discovery rate, implemented in the statsmodels package. Plasmid cluster hosts were inferred from PLSDB (version 2024_05_21_v2) when aligning to any PLSDB entry with >80% identity and >80% coverage. Functional annotations of contigs were performed with anvi’o (version 8) software, using the ‘anvi-run-workflow -w contigs’ command.",
          "children": []
        },
        {
          "title": "Resource usage",
          "level": 2,
          "content": "We evaluated computational resource usage of all methods using the CAMI2 airways reassembled dataset and five samples from the hospital sewage dataset. For the airways dataset, PlasMAAG took 46 min, using 8 threads and 16 GB of RAM. By contrast, SCAPP, excluding the BAM file generation step, took 192 min, using 16 threads and 24 GB of RAM (Supplementary Table (/articles/s41587-026-03005-7#MOESM1)). Among the other binners, PlasMAAG was slower than VAMB, MetaDecoder and MetaBAT2. For example, VAMB completed the task in just 8 min while using 8 threads and 16 GB of RAM. However, we observed a different trend when evaluating performances on the five hospital sewage samples. When accounting for the additional steps of read assembly and read mapping required to compute abundances, PlasMAAG exhibited similar runtimes to most binners, except for SCAPP, which required much more time. Specifically, PlasMAAG took 3,575 min, VAMB took 3,435 min, ComeBin required 4,911 min and metaplasmidSPAdes took 4,430 min (Supplementary Table (/articles/s41587-026-03005-7#MOESM1)). By contrast, SCAPP required 116,965 min, 32 times longer than PlasMAAG. This difference in runtime remained consistent even when excluding the read assembly steps (Supplementary Table (/articles/s41587-026-03005-7#MOESM1)).",
          "children": []
        },
        {
          "title": "Reporting summary",
          "level": 2,
          "content": "Further information on research design is available in the [Nature Portfolio Reporting Summary](/articles/s41587-026-03005-7#MOESM2) linked to this article.",
          "children": []
        }
      ]
    },
    {
      "title": "Data availability",
      "level": 1,
      "content": "Reads, contigs and contig annotations for the reassembled CAMI2 datasets are available online ( [https://erda.ku.dk/archives/826fe4d8889f88db2ec20058f9eaa015/published-archive.html](https://erda.ku.dk/archives/826fe4d8889f88db2ec20058f9eaa015/published-archive.html), [https://www.erda.dk/archives/fb3dc3896f827891dfd7a0c6f4bf91e1/published-archive.html](https://www.erda.dk/archives/fb3dc3896f827891dfd7a0c6f4bf91e1/published-archive.html) and [https://www.erda.dk/archives/18c60aa487d93b4f1d4813c1fd96c0f7/published-archive.html](https://www.erda.dk/archives/18c60aa487d93b4f1d4813c1fd96c0f7/published-archive.html)). The metagenomic short reads, metaplasmidomic short reads and metagenomic long reads from the five Danish hospital sewage samples, as well as the metagenomic short reads from the 24 Spanish hospital sewage samples, are available from the European Nucleotide Archive under BioProject [PRJEB85938](https://www.ebi.ac.uk/ena/data/view/PRJEB85938), whereas the assemblies for all samples are available online ( [https://erda.ku.dk/archives/e87f0d5e12ca4c1204379d4932c3ae59/published-archive.html](https://erda.ku.dk/archives/e87f0d5e12ca4c1204379d4932c3ae59/published-archive.html); Supplementary Table (/articles/s41587-026-03005-7#MOESM1)). [Source data](/articles/s41587-026-03005-7#Sec31) are provided with this paper.",
      "children": []
    },
    {
      "title": "Code availability",
      "level": 1,
      "content": "PlasMAAG is freely available from GitHub ( [https://github.com/RasmussenLab/PlasMAAG](https://github.com/RasmussenLab/PlasMAAG)), which includes instructions for reproducing main quantitative results, a demo test run, software dependencies and other relevant documentation.",
      "children": []
    }
  ],
  "figures": [
    {
      "id": "F1",
      "label": "",
      "caption": "Fig. 1: PlasMAAG workflow overview."
    },
    {
      "id": "F2",
      "label": "",
      "caption": "Fig. 2: PlasMAAG binning and classification performance across the benchmark datasets."
    },
    {
      "id": "F3",
      "label": "",
      "caption": "Fig. 3: Assembly graph, alignment graph and AAG-based features for binning."
    },
    {
      "id": "F4",
      "label": "",
      "caption": "Fig. 4: PlasMAAG on real samples from hospital sewage."
    },
    {
      "id": "F5",
      "label": "",
      "caption": "Fig. 5: PlasMAAG enables host–plasmid association studies and exploration of intraplasmid variation across environments, demonstrated using 24 hospital sewage samples."
    }
  ],
  "tables": [],
  "supplementary": []
}